---
title: STM8复位(reset)
toc: true
date: 2016-08-08 14:12:15
categories: STM8
tags: STM8
---
一款芯片，复位的重要性我认为不亚于其他任何一个单元模块。同时，开发固件时，对芯片的复位条件、复位源、复位后的系统状态的掌握直接决定后面系统工作的可靠性。
<center><img src="http://obd6jz6in.bkt.clouddn.com/%E5%A4%8D%E4%BD%8D.jpg"></center>
### 复位源
STM8复位源总共是6类，除了外部复位管脚提供的两种复位源(`NRST`和`SWIM REST`)，还有上下电(`POR\PDR`)复位、独立看门狗(`IWDG`)复位、窗口看门狗(`WWDG`)复位、非法配置选项复位(`ILLOP`)。STM8的用户指南里对各个部分的外设的复位状态有明确的说明，例如大部分IO口复位之后都是浮动输入模式，但也有少数例外，使用时应该时刻注意复位状态对系统可能的影响。

### 复位状态与正在复位状态
当复位源触发芯片复位后，芯片将进入一个复位期，这段时间里，芯片处在正在复位状态，完成硬件的初始化(默认复位状态),随后将跳转到复位向量处。在正在复位状态下，因为硬件可能没有复位到"复位状态"，一些管脚的状态值可能会和手册中的"复位值"不同。

### 复位管脚`NRST`
当这个管脚上出现一个不低于300ns的低电平时，将产生复位新号。这个管脚同时可以当做普通IO来使用，以此来提高可利用IO口数量。处于安全考虑，通过向`RTS_CR`寄存器写入`0xD0`将复位管家配置成O口，只在复位之后得第一次设置时有效。

### 上下电(`POR\PDR`)复位
当系统电源V<sub>DD</sub>上的电压从工作电压跌至低于下电阈值时产生下电复位，反之产生上电复位。并且在复位寄存器`RST_SR`中置起相应标志位。

### 窗口看门狗(`WWDG`)复位
这个看门狗必须在窗口内喂狗，否则当计数器减至`0x3F`时产生内部复位。

### 独立看门狗(`IWDG`)复位
减计数看门狗，设定的时间间隔内不喂狗，产生复位新号。

*以上只是一些简单的概要，详细细节见* **[STM8L 用户指南](http://obd6jz6in.bkt.clouddn.com/STM8L%20%E7%94%A8%E6%88%B7%E6%8C%87%E5%8D%97.pdf)**