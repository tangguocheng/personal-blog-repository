---
title: STM8时钟系统(clock)
toc: true
date: 2016-08-05 14:12:15
categories: STM8
tags: STM8
---
## STM8时钟结构(clock structure)
<center>![STM8时钟结构](http://obd6jz6in.bkt.clouddn.com/STM8%E6%97%B6%E9%92%9F%E7%BB%93%E6%9E%84.jpg)</center>

## 时钟分类
STM的时钟设计同时兼顾系统的鲁棒性及低功耗，共提供四类时钟,分别为高速外部时钟`HSE`、高速内部时钟`HSI`、低速内部时钟`LSI`、低速外部时钟`LSE`。

### 高速外部时钟`HSE`
可由以下两个时钟源产生:
- 外部晶体/陶瓷振荡器
- 外部用户时钟源（byPass）
在外部晶体震荡稳定下来之后外部时钟寄存器`CLK_ECKCR`中的`HSERDY`标志位会由硬件置位，用户可查询该标志位判断`HSE`的状态，另外可通过`HSEON`位控制`HSE`的开关。

### 高速内部时钟`HSI`
- `HSI`由内部集成的RC振荡器产生的16MHz频率。在系统启动时，由硬件自动将系统时钟源切换为`HSI`的8分频，也就是系统起始时钟频率为8MHz。`HSI`具有低功耗、快速的起振时间的特性，但是相比由外部晶体提供时钟源的`HSE`，精度稍差。
- `HSI`在出厂时是完成过校准的，用户也可以通过`CLK_HSICALR`寄存器校准`HSI`。
- `HSI`另外一个特点是作为备用时钟源，当`CSS(clock security system)`检测到`HSE`晶体停振，会自动将系统时钟切换到`HSI`，已保证系统的稳定运行。
当设置了`FHWU`快速唤醒功能时，MCU在从停止状态唤醒时会自动切换到`HSI`完成快速唤醒。

### 低速外部时钟`LSE`
由外接32768Hz的时钟源提供，主要为RTC提供高精度时钟源。

### 低速内部时钟`LSI`
`LSI`提供38KHz的时钟频率，可以在活跃停机下保持运行，给独立看门狗提供时钟频率。

## CSS
对于工业级产品，对稳定性要求很高，STM8的时钟机制可以提高系统的鲁棒性。`CSS`在`HSE`作为系统时钟时会一直处在监控状态，一旦`HSE`失效，硬件会自动切换到`HSI`，系统时钟分频系数不变。用户可以通过`CSSEN`设置`CSS`使能，一旦设置使能，知道系统复位，`CSS`将一直存在使能的状态且不可关闭。

## 时钟中断
时钟控制器可以在一定条件下产生如下中断和事件
<center>![时钟中断](http://obd6jz6in.bkt.clouddn.com/%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD.jpg)</center>

*以上只是简单的概要，详细细节见* **[STM8L 用户指南](http://obd6jz6in.bkt.clouddn.com/STM8L%20%E7%94%A8%E6%88%B7%E6%8C%87%E5%8D%97.pdf)** 